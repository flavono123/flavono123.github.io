<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1">
<title>ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ì— ê°„ë‹¨í•œ ëª…ë ¹í•˜ê¸°(Ansible vs. PSSH) | flavono123</title>
<link rel=stylesheet href=https://flavono123.github.io/assets/css/post.css>
<script defer src=https://flavono123.github.io/assets/js/lbox.js></script>
<link rel=stylesheet href=https://flavono123.github.io/assets/css/common.css>
</head>
<body>
<main>
<header>
<a class=site-title href=https://flavono123.github.io/>flavono123</a>
</header>
<section class=article>
<div class=article-header>
<h2 class=article-title>ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ì— ê°„ë‹¨í•œ ëª…ë ¹í•˜ê¸°(Ansible vs. PSSH)</h2>
<small class=date>Thu Mar 24, 2022</small>
<div class=tags>
<a href=https://flavono123.github.io/tags/ansible class=tag>ansible</a>
<a href=https://flavono123.github.io/tags/pssh class=tag>pssh</a>
</div>
</div>
<div class=content><p>ì´ ê¸€ì€ í”„ë¡œë¹„ì €ë‹ íˆ´ë¡œì¨ Ansibleê³¼ PSSHë¥¼ ë¹„êµí•˜ëŠ” ê¸€ì´ ì•„ë‹ˆë‹¤. ê°„ë‹¨í•œ ëª…ë ¹ì„ í•  ë•Œ Ansibleê³¼ PSSH ë‘˜ ë‹¤ ì‚¬ìš©í•´ë³´ê³  ë¹„êµí•˜ëŠ” ê¸€ì´ë‹¤.</p>
<p>ë‚˜ëŠ” í”„ë¡œë¹„ì €ë‹ íˆ´ë¡œì¬ Ansibleì„ ì´ë¯¸ ì“°ê³  ìˆëŠ”ë°, ë§‰ìƒ ê°„ë‹¨í•œ ëª…ë ¹ì„ í•˜ë ¤ë‹ˆ &ldquo;PSSHë¥¼ ì“°ëŠ”ê²Œ ë” ì‰¬ìš´ê°€?&rdquo; ë¼ëŠ” ìƒê°ì´ ë“¤ì—ˆë‹¤. ìƒí™©ì€ ê°„ë‹¨í•˜ê²Œ ê° í˜¸ìŠ¤íŠ¸ì˜ ê³µì¸ IPë¥¼ ì•Œì•„ë‚´ëŠ” ê²ƒì´ë‹¤. ê° í˜¸ìŠ¤íŠ¸ì—ì„œ <code>curl ifconfig.me</code> ë¥¼ ì‹¤í–‰í•˜ê³  ì¶œë ¥ì„ í™•ì¸í•´ì•¼ í•œë‹¤.</p>
<h2 id=pssh>PSSH</h2>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ pssh --version
2.3.1
</code></pre></div><h4 id=í˜¸ìŠ¤íŠ¸-ì¸ìë¡œ-ì¸ë²¤í† ë¦¬-íŒŒì¼-í™œìš©>í˜¸ìŠ¤íŠ¸ ì¸ìë¡œ ì¸ë²¤í† ë¦¬ íŒŒì¼ í™œìš©</h4>
<p>ì•ì„œ ë§í•œ ë“¯ Ansibleì„ ì‚¬ìš©í•˜ê³  ìˆëŠ” ìƒí™©ì´ê¸° ë•Œë¬¸ì— PSSHì˜ í˜¸ìŠ¤íŠ¸ ì¸ìë¡œ Ansibleì˜ ì¸ë²¤í† ë¦¬ INI íŒŒì¼ì„ ì“¸ ê²ƒì´ë‹¤. ì¸ë²¤í† ë¦¬ íŒŒì¼ì„ ì •ì˜í•˜ëŠ” ê²ƒ ë‚˜ë¦„ì´ê² ì§€ë§Œ, ì–´ì¨Œë“  ssh ì ‘ì†í•  ìˆ˜ ìˆëŠ” í˜¸ìŠ¤íŠ¸ëª…ì„ í¬í•¨í•˜ê³  ìˆì„ ê²ƒì´ë‹¤(ì–´ì©Œë©´ í˜¸ìŠ¤íŠ¸ë³€ìˆ˜ yaml íŒŒì¼ì— ìˆì„ ê²ƒì´ë‹¤). ë‚˜ì˜ ê²½ìš°ëŠ” INI íŒŒì¼ ì»¨ë²¤ì…˜ì´ ë‹¤ìŒê³¼ ê°™ë‹¤:</p>
<pre tabindex=0><code>&lt;type&gt;_host1 ansible_host=host1 [...]
...

[&lt;type&gt;_servers]
&lt;type&gt;_host1
...
</code></pre><ul>
<li><code>&lt;type>_host1</code>: Ansible í˜¸ìŠ¤íŠ¸ëª…(hosts)ì„ ìš©ë„ì— ë”°ë¥¸ ì‹œë§¨í‹± ì´ë¦„ì¸, ì„œë²„ íƒ€ì…(<code>&lt;type></code>)ê³¼ ì‹¤ì œ ssh ì ‘ì†ì— ì‚¬ìš©í•˜ëŠ” hostnameì„ <code>_</code> ë¡œ ì‡ëŠ”ë‹¤</li>
<li><code>[&lt;type>_servers</code>]: ê·¸ë£¹ëª…ì€ ê°„ë‹¨í•˜ê²Œ íƒ€ì… ë’¤ì— <code>_servers</code>ë¥¼ ë¶™ì¸ë‹¤(e.g. widget_servers)</li>
<li><code>ansible_host=host1 [...]</code>: <code>ansible_</code>ë¡œ ì‹œì‘í•˜ëŠ” ëª‡ëª‡ í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜ëŠ” INI íŒŒì¼ì— ê·¸ëŒ€ë¡œ ì“°ê³  ìˆë‹¤(ì™œ ì´ê±´ yamlì— ì•ˆì¼ì„ê¹Œ ì‹¶ë‹¤ .. ğŸ¤”)</li>
</ul>
<p>ì´ëŸ° ì¡°ê±´ì—ì„œ ë‚˜ëŠ” <code>&lt;type>_host1</code> ì—ì„œ í˜¸ìŠ¤íŠ¸ëª…ì„ íŒŒì‹±í•˜ë©° PSSH í˜¸ìŠ¤íŠ¸ ì¸ìë¥¼ ë§Œë“¤ê¸°ë¡œ í–ˆë‹¤.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ cat &lt;invetory_file&gt; | grep -vE <span style=color:#e6db74>&#39;^\[&#39;</span> |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  awk <span style=color:#e6db74>&#39;NF {sub(&#34;&lt;type&gt;_&#34;, &#34;&#34;, $1); print $1}&#39;</span> |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  sort | uniq |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  xargs -I<span style=color:#f92672>{}</span> echo -H <span style=color:#f92672>{}</span> |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>  tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39; &#39;</span>
-H host1 -H host2 -H host3
</code></pre></div><ul>
<li><code>grep -vE '^\['</code>: ê·¸ë£¹ ì •ì˜ ë¼ì¸ì„ ì œì™¸í•œë‹¤</li>
<li><code>awk 'NF {sub("&lt;type>_", "", $1); print $1}'</code>: ê³µë°± ì¤„ì„ ì œê±°í•˜ê³ , Ansible í˜¸ìŠ¤íŠ¸ëª…ì—ì„œ <code>&lt;type>_</code>ì„ ì œê±°í•˜ì—¬ SSH í˜¸ìŠ¤íŠ¸ëª…ë§Œ ë‚¨ê¸´ë‹¤</li>
<li><code>sort | uniq</code>: ì¤‘ë³µì„ ì œê±°í•œë‹¤(ìœ„ì— í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜ ì •ì˜ ë•Œë¬¸ì— ì¤‘ë³µì´ ìˆìŒ)</li>
<li><code>xargs -I{} echo -H {}</code>: í˜¸ìŠ¤íŠ¸ëª…ì„ &ldquo;-H &ldquo;ì— ë§¤í•‘í•˜ê³ </li>
<li><code>tr '\n' ' '</code>: ê° ë¼ì¸ì„ ê³µë°±ìœ¼ë¡œ í•©ì¹œë‹¤</li>
</ul>
<p><code>awk</code>ë‚˜ map join(<code>xargs</code>, <code>tr</code>)ë¥¼ ë” ì˜ ì“°ë©´ ëª…ë ¹ì„ ì¤„ì¼ ìˆ˜ ìˆì„ê±° ê°™ë‹¤.</p>
<p>ë˜ëŠ” <code>ansible_host</code> ê°€ í˜¸ìŠ¤íŠ¸ ë³€ìˆ˜ yaml íŒŒì¼ì— ì •ì˜ë˜ì–´ ìˆë‹¤ë©´, yamlë§Œ íŒŒì‹±í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì— ë”ìš± ì‰¬ìš¸ ê²ƒì´ë‹¤. <code>&lt;type></code>ì„ widgetì´ë¼ í•˜ê³  ì¸ë²¤í† ë¦¬ íŒŒì¼ ì „ì²´ë¥¼ yamlë¡œ ì“°ë©´ ë‹¤ìŒê³¼ ê°™ì„ ê²ƒì´ê³ :</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>widget_servers</span>:
  <span style=color:#f92672>hosts</span>:
    <span style=color:#f92672>widget_host1</span>:
      <span style=color:#f92672>ansible_host</span>: <span style=color:#ae81ff>host1</span>
    <span style=color:#f92672>widget_host2</span>:
      <span style=color:#f92672>ansible_host</span>: <span style=color:#ae81ff>host2</span>
    <span style=color:#f92672>widget_host3</span>:
      <span style=color:#f92672>ansible_host</span>: <span style=color:#ae81ff>host3</span>
</code></pre></div><p>yqë¡œ íŒŒì‹±í•˜ì—¬ ëª¨ë“  ansible_hostë¥¼ ì½ëŠ”ë‹¤.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ cat host.yaml | yq <span style=color:#e6db74>&#39;.widget_servers.hosts[&#34;*&#34;].ansible_host&#39;</span> |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>   xargs -I<span style=color:#f92672>{}</span> echo -H <span style=color:#f92672>{}</span> |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>   tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39; &#39;</span>
-H host1 -H host2 -H host3
</code></pre></div><h4 id=ëª…ë ¹í•˜ê³ -ì¶œë ¥-ë‹¤ë£¨ê¸°>ëª…ë ¹í•˜ê³  ì¶œë ¥ ë‹¤ë£¨ê¸°</h4>
<p>ì´ ëª…ë ¹ ê²°ê³¼ë¥¼ ì¸ìë¡œ ì£¼ì–´ PSSH ëª…ë ¹ì„ í•´ë³¸ë‹¤(ë‚˜ëŠ” ë‹¤ì‹œ INI íŒŒì¼ì˜ ê²½ìš°ë¡œ)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ pssh <span style=color:#66d9ef>$(</span>cat &lt;inventory_file&gt; grep -vE <span style=color:#e6db74>&#39;^\[&#39;</span> | awk <span style=color:#e6db74>&#39;NF {sub(&#34;&lt;type&gt;&#34;, &#34;&#34;, $1); print $1}&#39;</span> | sort | uniq | xargs -I<span style=color:#f92672>{}</span> echo -H <span style=color:#f92672>{}</span> | tr <span style=color:#e6db74>&#39;\n&#39;</span> <span style=color:#e6db74>&#39; &#39;</span><span style=color:#66d9ef>)</span><span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>   curl ifconfig.me
<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> 12:47:14 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host3
<span style=color:#f92672>[</span>2<span style=color:#f92672>]</span> 12:47:14 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host1
<span style=color:#f92672>[</span>3<span style=color:#f92672>]</span> 12:47:14 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host2
</code></pre></div><p>PSSHëŠ” ì‹¤í–‰í•˜ëŠ” ê³³ì—ì„  ê° í˜¸ìŠ¤íŠ¸ ì„±ê³µ ì‹¤íŒ¨ ì—¬ë¶€ë§Œ ì¶œë ¥í•˜ê¸° ë•Œë¬¸ì— ë³´ë‚¸ ëª…ë ¹, <code>curl ifconfig.me</code>, ì˜ ì¶œë ¥ì„ ë³¼ ìˆ˜ ì—†ë‹¤. <code>-i</code> ì˜µì…˜ì„ ì£¼ë©´ ë³´ë‚¸ ëª…ë ¹ì˜ í‘œì¤€ ì¶œë ¥ì„ ì¶œë ¥í•˜ì§€ë§Œ, ì—ëŸ¬ë„ ê°™ì´ ì¶œë ¥í•œë‹¤.</p>
<p>ë”°ë¼ì„œ í‘œì¤€ ì¶œë ¥ë§Œ ì¶œë ¥í•˜ëŠ” <code>--inline-stdout</code>ì„ ì“°ê±°ë‚˜ <code>-i</code> ì˜µì…˜ê³¼ <code>curl -s ifconfig.me</code>ë¥¼ ê°™ì´ ì‚¬ìš©í•˜ì—¬ curlì—ì„œ í‘œì¤€ ì—ëŸ¬ë¥¼ ì—†ì• ëŠ” ë²•ì´ ìˆë‹¤:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=color:#75715e># í˜¸ìŠ¤íŠ¸ ì¸ì ë§Œë“œëŠ” ëª…ë ¹ì„ $(ansible_inventory_to_pssh_host) ë¡œ ëŒ€ì²´</span>
â¯ pssh <span style=color:#66d9ef>$(</span>ansible_inventory_to_pssh_host<span style=color:#66d9ef>)</span> -i curl -s ifconfig.me
<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> 13:11:32 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host2
223.xxx.yyy.zzz<span style=color:#f92672>[</span>2<span style=color:#f92672>]</span> 13:11:32 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host3
223.xxx.yyy.zzz<span style=color:#f92672>[</span>3<span style=color:#f92672>]</span> 13:11:32 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host1
223.xxx.yyy.zzz

â¯ pssh <span style=color:#66d9ef>$(</span>ansible_inventory_to_pssh_host<span style=color:#66d9ef>)</span> -i curl -s ifconfig.me
<span style=color:#f92672>[</span>1<span style=color:#f92672>]</span> 13:11:34 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host3
223.xxx.yyy.zzz<span style=color:#f92672>[</span>2<span style=color:#f92672>]</span> 13:11:34 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host1
223.xxx.yyy.zzz<span style=color:#f92672>[</span>3<span style=color:#f92672>]</span> 13:11:34 <span style=color:#f92672>[</span>SUCCESS<span style=color:#f92672>]</span> host2
223.xxx.yyy.zzz
</code></pre></div><p>ì¶œë ¥ì´ ì¡°ê¸ˆ ì´ìƒí•˜ë‹¤. curlì˜ ì¶œë ¥ì¸ IPê°€ ê°œí–‰ì„ í¬í•¨í•˜ì§€ ì•Šê³  ë„˜ì–´ì™€ ë‹¤ìŒ í˜¸ìŠ¤íŠ¸ ì„±ê³µì— ëŒ€í•œ ë©”ì„¸ì§€ì™€ ê°™ì€ ì¤„ì— ì¶œë ¥ëœë‹¤. ì˜ˆì‹œì˜ ê²½ìš°ëŠ” ì•„ì£¼ ê°„ë‹¨í•´ì„œ í•œ ëˆˆì— ê²°ê³¼ë¥¼ íŒŒì•…í•˜ëŠ”ë° ì–´ë ¤ì›€ì€ ì—†ë‹¤(ì‹¤ì œë¡œ ë‚˜ëŠ” ê³µì¸ IPê°€ ëª¨ë‘ ê°™ì€ í˜¸ìŠ¤íŠ¸ì— ëª…ë ¹í–ˆë‹¤). í•˜ì§€ë§Œ í˜¸ìŠ¤íŠ¸ê°€ í›¨ì”¬ ë§ê±°ë‚˜ ëª…ë ¹ì˜ ê²°ê³¼ë‚˜ ì–‘ì‹ì´ ì¡°ê¸ˆ ë” ë³µì¡í•´ì§€ë©´ PSSHê°€ ë­‰ì³ì§„ ê²°ê³¼ë¥¼ ë‹¤ë£¨ëŠ”ë° ì–´ë ¤ì›€ì´ ìˆì„ ê²ƒì´ë‹¤.</p>
<h2 id=ansible>Ansible</h2>
<p>PSSHëŠ” ëª…ë ¹ì„ ë³´ë‚¼ í˜¸ìŠ¤íŠ¸ëª… ì¸ìë¥¼ ë§Œë“œëŠ”ë°ì— ê³µìˆ˜ê°€ ë§ì´ ë“¤ì–´ê°”ë‹¤. í•˜ì§€ë§Œ Ansibleì€ ì¸ë²¤í† ë¦¬ íŒŒì¼ì„ ê·¸ëŒ€ë¡œ ì“¸ ê²ƒì´ê¸° ë•Œë¬¸ì— ë¬¸ì œê°€ ì—†ë‹¤. ë˜ ì‹¤ì§ˆì (?)ìœ¼ë¡œ ìœ íš¨í•œ ì ë„ ìˆë‹¤. Ansibleì„ ì“°ê³  ìˆë‹¤ë©´ í˜•ìƒê´€ë¦¬ê°€ ë˜ê³  ìˆì„ ê²ƒì´ë¼ í˜¸ìŠ¤íŠ¸ëª…ê³¼ ê·¸ë£¹ ë“±ì„ ì›í•˜ëŠ”ëŒ€ë¡œ ë‹¤ë£¨ê¸° ì‰¬ìš¸ ê²ƒì´ë‹¤. ë°˜ë©´ PSSHëŠ” ìì£¼ ì“°ëŠ” ëª…ë ¹ì´ ì•„ë‹ˆë¼, ìœ„ì—ì„œ ì†Œê°œí•œ ë°©ë²•ìœ¼ë¡œ Ansible ì¸ë²¤í† ë¦¬ ì½”ë“œê°€ ë°”ë€” ë•Œ í˜¸ìŠ¤íŠ¸ íŒŒì¼ì„ ë§Œë“¤ì–´ì•¼ í•  ê²ƒì´ë‹¤.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ ansible --version
ansible <span style=color:#f92672>[</span>core 2.11.6<span style=color:#f92672>]</span>
  config file <span style=color:#f92672>=</span> /etc/ansible/ansible.cfg
  ...<span style=color:#f92672>(</span>opaque<span style=color:#f92672>)</span>...
  python version <span style=color:#f92672>=</span> 3.8.8 <span style=color:#f92672>(</span>default, Nov <span style=color:#ae81ff>23</span> 2021, 14:07:49<span style=color:#f92672>)</span> <span style=color:#f92672>[</span>Clang 13.0.0 <span style=color:#f92672>(</span>clang-1300.0.29.3<span style=color:#f92672>)]</span>
  jinja version <span style=color:#f92672>=</span> 3.0.3
  libyaml <span style=color:#f92672>=</span> True
</code></pre></div><p>Ansible ad-hoc ëª…ë ¹ì— ëŒ€í•´ ì§§ê²Œ ì„¤ëª…í•œë‹¤. ë§ì€ ì‚¬ëŒë“¤ì´ ansible-playbook ëª…ë ¹ë³´ë‹¤ ì˜¤íˆë ¤ ansible ëª…ë ¹ì´ ë” ì–´ìƒ‰í•  ìˆ˜ë„ ìˆë‹¤. ì´ë¯¸ ìˆëŠ” ì¸í”„ë¼ë¥¼ êµ¬ì¡°ë¥¼ ê°–ì¶”ì–´ ì½”ë“œë¡œ ì˜®ê¸°ë©´ playbookì„ ë°”ë¡œ ì‚¬ìš©í–ˆì„ ê²ƒì´ê³  ë‚˜ë„ ê·¸ë ‡ë‹¤:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ ansible &lt;group&gt; -i &lt;inventory_file&gt; -m &lt;module&gt; -a &lt;module_args&gt;
</code></pre></div><p>Playbookì´ ì•„ë‹Œ ëª¨ë“ˆê³¼ ëª¨ë“ˆì˜ ì¸ìë¥¼ ì§€ì •í•˜ì—¬ ë§ˆì¹˜ ë‹¨ì¼ íƒœìŠ¤í¬ì²˜ëŸ¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤. ì§€ê¸ˆ í•˜ê³  ìˆëŠ” ì˜ˆì‹œë¡œ ëª…ë ¹í•œë‹¤ë©´:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ ansible &lt;group&gt; -i &lt;invenotry_file&gt; -m command -a <span style=color:#e6db74>&#34;/usr/bin/curl -s ifconfig.me&#34;</span>
host2 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
223.xxx.yyy.zzz
host3 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
223.xxx.yyy.zzz
host1 | CHANGED | rc<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span> &gt;&gt;
223.xxx.yyy.zzz
</code></pre></div><p>command ëª¨ë“ˆì— ì‹¤í–‰í•˜ë ¤ëŠ” ëª…ë ¹ì„ ì¸ìë¡œ ì£¼ì—ˆë‹¤. PSSH ì¶œë ¥ë³´ë‹¤ ì‹¤í–‰ í˜¸ìŠ¤íŠ¸ì™€ ì¶œë ¥ì´ ë°”ë¡œ ë‹¤ìŒ ì¤„ì— ë‚˜ì™€ ì¡°ê¸ˆ ë” ì •ëˆëœ ëª¨ìŠµì„ ë³´ì—¬ì¤€ë‹¤.</p>
<h4 id=ëª¨ë“ˆ-ì¶œë ¥ì„-í¬í•¨í•´-jsonìœ¼ë¡œ-ì²˜ë¦¬í•˜ê¸°>ëª¨ë“ˆ ì¶œë ¥ì„ í¬í•¨í•´ JSONìœ¼ë¡œ ì²˜ë¦¬í•˜ê¸°</h4>
<p>ë‹¨ìˆœíˆ ì‰˜ì— ëª…ë ¹ì„ ë‚ ë¦¬ëŠ”ê²Œ ì•„ë‹ˆë¼ Ansibleì„ ì“°ëŠ” ì¥ì ì„ ì´ìš©í•˜ê¸° ìœ„í•´ curlì— í•´ë‹¹í•˜ëŠ” <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/uri_module.html>uri</a> ë¹ŒíŠ¸ì¸ ëª¨ë“ˆì„ ì‚¬ìš©í•´ë´¤ë‹¤.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ ansible &lt;group&gt; -i &lt;inventory_file&gt; -m uri -a <span style=color:#e6db74>&#34;
</span><span style=color:#e6db74>    url=https://ifconfig.me
</span><span style=color:#e6db74>    return_content=yes
</span><span style=color:#e6db74>    http_agent=curl/7.64.1&#34;</span>
</code></pre></div><ul>
<li><code>url</code>: curlê³¼ ë‹¬ë¦¬ í”„ë¡œí† ì½œì„ ëª…ì‹œí•´ì£¼ì–´ì•¼ í•œë‹¤.</li>
<li><code>return_content=yes</code>: ìš”ì²­ì˜ ì‘ë‹µ(<code>content</code> í•„ë“œ)ì´ í¬í•¨ë˜ê²Œ í•œë‹¤.</li>
<li><code>http_agent=curl/7.64.1</code>: ifconfig.meëŠ” agentì— ë”°ë¼ ì¶œë ¥ì„ ë‹¬ë¦¬ ì¤€ë‹¤(ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†í•˜ì—¬ í™•ì¸í•´ë³´ì). ë”°ë¼ì„œ IP ì£¼ì†Œë§Œ ì‘ë‹µ ë°›ë„ë¡ curl ëª…ë ¹í•  ë•Œì™€ ê°™ê²Œ í•´ì£¼ì—ˆë‹¤.</li>
</ul>
<p>ì¶œë ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>type_host1 | SUCCESS <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
    <span style=color:#e6db74>&#34;access_control_allow_origin&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
    <span style=color:#e6db74>&#34;alt_svc&#34;</span>: <span style=color:#e6db74>&#34;clear&#34;</span>,
    <span style=color:#e6db74>&#34;ansible_facts&#34;</span>: <span style=color:#f92672>{</span>
        <span style=color:#e6db74>&#34;discovered_interpreter_python&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/python3&#34;</span>
    <span style=color:#f92672>}</span>,
    <span style=color:#e6db74>&#34;changed&#34;</span>: false,
    <span style=color:#e6db74>&#34;connection&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>,
    <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;223.xxx.yyy.zzz&#34;</span>,
    <span style=color:#e6db74>&#34;content_length&#34;</span>: <span style=color:#e6db74>&#34;15&#34;</span>,
    <span style=color:#e6db74>&#34;content_type&#34;</span>: <span style=color:#e6db74>&#34;text/plain; charset=utf-8&#34;</span>,
    ...<span style=color:#f92672>(</span>ìƒëµ<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
type_host2 | SUCCESS <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
    <span style=color:#e6db74>&#34;access_control_allow_origin&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
    <span style=color:#e6db74>&#34;alt_svc&#34;</span>: <span style=color:#e6db74>&#34;clear&#34;</span>,
    <span style=color:#e6db74>&#34;ansible_facts&#34;</span>: <span style=color:#f92672>{</span>
        <span style=color:#e6db74>&#34;discovered_interpreter_python&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/python3&#34;</span>
    <span style=color:#f92672>}</span>,
    <span style=color:#e6db74>&#34;changed&#34;</span>: false,
    <span style=color:#e6db74>&#34;connection&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>,
    <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;223.xxx.yyy.zzz&#34;</span>,
    <span style=color:#e6db74>&#34;content_length&#34;</span>: <span style=color:#e6db74>&#34;15&#34;</span>,
    <span style=color:#e6db74>&#34;content_type&#34;</span>: <span style=color:#e6db74>&#34;text/plain; charset=utf-8&#34;</span>,
    ...<span style=color:#f92672>(</span>ìƒëµ<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
type_host3 | SUCCESS <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
    <span style=color:#e6db74>&#34;access_control_allow_origin&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
    <span style=color:#e6db74>&#34;alt_svc&#34;</span>: <span style=color:#e6db74>&#34;clear&#34;</span>,
    <span style=color:#e6db74>&#34;ansible_facts&#34;</span>: <span style=color:#f92672>{</span>
        <span style=color:#e6db74>&#34;discovered_interpreter_python&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/python3&#34;</span>
    <span style=color:#f92672>}</span>,
    <span style=color:#e6db74>&#34;changed&#34;</span>: false,
    <span style=color:#e6db74>&#34;connection&#34;</span>: <span style=color:#e6db74>&#34;close&#34;</span>,
    <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;223.xxx.yyy.zzz&#34;</span>,
    <span style=color:#e6db74>&#34;content_length&#34;</span>: <span style=color:#e6db74>&#34;15&#34;</span>,
    <span style=color:#e6db74>&#34;content_type&#34;</span>: <span style=color:#e6db74>&#34;text/plain; charset=utf-8&#34;</span>,
    ...<span style=color:#f92672>(</span>ìƒëµ<span style=color:#f92672>)</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>&ldquo;Ansible host | ì„±ê³µ ì‹¤íŒ¨ ì—¬ë¶€ =>&rdquo; ë’¤ì— ëª¨ë“ˆ ê²°ê³¼ì¸ JSON ìˆê³  ì—¬ê¸°ì—” curlì˜ ì¶œë ¥(content)ë¥¼ í¬í•¨í•´ì„œ HTTP ì‘ë‹µ í—¤ë”ë‚˜, ansible facts ê°™ì€ ë©”íƒ€ë°ì´í„°ë“¤ì´ ìˆë‹¤. ì´ê±¸ ì¢€ ë‹¤ë“¬ìœ¼ë©´ Ad-hoc ëª…ë ¹ì˜ ê²°ê³¼ë¥¼ JSONìœ¼ë¡œ ì‰½ê²Œ ë‹¤ë£° ìˆ˜ ìˆì–´ ë³´ì¸ë‹¤:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ &lt;ansible_ad_hoc_command&gt; | sed -E <span style=color:#e6db74>&#39;s/(.*) \| FAILED\! \=&gt; \{/\{&#34;ansible_host&#34;: &#34;\1&#34;, &#34;success&#34;: false,/;
</span><span style=color:#e6db74>                                     s/(.*) \| SUCCESS \=&gt; \{/\{&#34;ansible_host&#34;: &#34;\1&#34;, &#34;success&#34;: true,/&#39;</span>
</code></pre></div><p>ansible_hostì™€ ì„±ê³µ ì‹¤íŒ¨ ì—¬ë¶€ í•„ë“œ(success)ë¥¼ í¬í•¨í•œ JSONìœ¼ë¡œ ë°”ê¿”ì¤€ë‹¤. ì •ë ¬ì€ ì´ìƒí•˜ì§€ë§Œ, jqë¡œ ì´ì˜ê²Œ ì¶œë ¥í•˜ê±°ë‚˜ íŒŒì‹±í•  ìˆ˜ ìˆë‹¤:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>â¯ ansible &lt;group&gt; -i &lt;inventory_file&gt; -m uri -a <span style=color:#e6db74>&#34;url=https://ifconfig.me
</span><span style=color:#e6db74>                                                 return_content=yes
</span><span style=color:#e6db74>                                                 http_agent=curl/7.64.1&#34;</span> |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>sed -E <span style=color:#e6db74>&#39;s/(.*) \| FAILED\! \=&gt; \{/\{&#34;ansible_host&#34;: &#34;\1&#34;, &#34;success&#34;: false,/;
</span><span style=color:#e6db74>        s/(.*) \| SUCCESS \=&gt; \{/\{&#34;ansible_host&#34;: &#34;\1&#34;, &#34;success&#34;: true,/&#39;</span> |<span style=color:#ae81ff>\
</span><span style=color:#ae81ff></span>jq <span style=color:#e6db74>&#39;{&#34;host&#34;: .ansible_host, &#34;content&#34;: .content}&#39;</span>
<span style=color:#f92672>{</span>
  <span style=color:#e6db74>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;type_host2&#34;</span>,
  <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;223.xxx.yyy.zzz&#34;</span>
<span style=color:#f92672>}</span>
<span style=color:#f92672>{</span>
  <span style=color:#e6db74>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;type_host1&#34;</span>,
  <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;223.xxx.yyy.zzz&#34;</span>
<span style=color:#f92672>}</span>
<span style=color:#f92672>{</span>
  <span style=color:#e6db74>&#34;host&#34;</span>: <span style=color:#e6db74>&#34;type_host3&#34;</span>,
  <span style=color:#e6db74>&#34;content&#34;</span>: <span style=color:#e6db74>&#34;223.xxx.yyy.zzz&#34;</span>
<span style=color:#f92672>}</span>
</code></pre></div><p>ë‚˜ëŠ” ì´ëŸ° ê°„ë‹¨í•œ ëª…ë ¹ì„ ì—¬ëŸ¬ í˜¸ìŠ¤íŠ¸ì— ë‚ ë¦¬ëŠ” ìƒí™©ì—ì„ , PSSH ë³´ë‹¨ Ansible ad-hocìœ¼ë¡œ ì‘ì—…ì„ í•˜ë ¤ê³  í•œë‹¤. ì¸ë²¤í† ë¦¬ë¥¼ ê·¸ëŒ€ë¡œ ì“¸ ìˆ˜ ìˆê³  ì¸ë²¤í† ë¦¬ íŒŒì¼ì€ í˜•ìƒê´€ë¦¬ê°€ ì˜ ë  ìˆ˜ ìˆë‹¤ëŠ” ì ì´ ì œì¼ í° ì´ìœ ì´ë‹¤. ê²°ê³¼ë¥¼ JSONìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” ê²ƒë„ ì¥ì ì´ë‹¤. ë˜ Ansible ëª¨ë“ˆì˜ ì¥ì (e.g. ë©±ë“±ì„± ë³´ì¥)ê³¼ ëª¨ë“ˆë„ ì´ê²ƒì €ê²ƒ ì¨ë³´ê²Œ ë˜ëŠ”ê²Œ ë‚«ë‹¤ê³  ìƒê°í•´ì„œ ê·¸ë ‡ë‹¤.</p>
<h2 id=ì •ë¦¬>ì •ë¦¬</h2>
<ul>
<li>PSSH
<ul>
<li>í˜•ìƒê´€ë¦¬ ë˜ê³  ìˆëŠ” Ansible ì¸ë²¤í† ë¦¬ íŒŒì¼ì„ ì¡°ì‘í•´ì„œ í˜¸ìŠ¤íŠ¸ ì¸ìë¡œ ì“¸ ìˆ˜ ìˆë‹¤.</li>
<li>ëª…ë ¹ ê²°ê³¼ê°€ plain textë¼ ì¡°ì‘(reduceë“±)ì´ ì–´ë µë‹¤.</li>
</ul>
</li>
<li>Ansible
<ul>
<li><a href=https://gist.github.com/flavono123/65522ea36a1c957c74daac0dd99c8180>ê²°ê³¼ë¥¼ ì¡°ê¸ˆ ë°”ê¾¸ë©´</a> JSONìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë‹¤.</li>
</ul>
</li>
</ul>
<hr>
<h2 id=ì°¸ê³ >ì°¸ê³ </h2>
<ul>
<li><a href=https://linux.die.net/man/1/pssh>https://linux.die.net/man/1/pssh</a></li>
<li><a href=https://ansible-tips-and-tricks.readthedocs.io/en/latest/ansible/commands/>https://ansible-tips-and-tricks.readthedocs.io/en/latest/ansible/commands/</a></li>
<li><a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/uri_module.html>https://docs.ansible.com/ansible/latest/collections/ansible/builtin/uri_module.html</a></li>
</ul>
</div>
</section>
<div id=disqus_thread></div>
<script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//flavono123.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script>
<noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript>
<a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a>
<footer>
<p>&copy; 2021 - 2022 </p>
</footer>
</main>
</body>
</html>